<!DOCTYPE html>
<html>

<head>
  <title>Basic LWL</title>
  <meta charset="utf-8"/>
  <script src="jspsych-6.1.0/jspsych.js"> </script>
  <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
  <script src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
  <!-- <script src="jspsych-6.1.0/papaparse.min.js"></script>  -->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.0.2/papaparse.min.js"></script> -->
  <script src="jspsych-6.1.0/plugins/jspsych-audio-button-response-flexiblelocations.js"></script>
  <!--<script src="jspsych-6.1.0/google-spreadsheet.js"></script> -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
  <link rel="stylesheet" href="jspsych-6.1.0/css/jspsych.css",type="text/css"> </link>
  <link href="css/jspsych.css" rel="stylesheet" type="text/css"></link>
  <style>
  div.absolute {
    position: absolute;
    left: 10px;
    right:0px;
    top:10px;
    border: 3px solid #73AD21;
    background-image: url("stimuli/images/face-closed.jpg");
  }
  </style>
</head>
<body>
  <div id="jspsych-lwl"></div>
</body>

<script>

// $('body,html').addClass('stop-scrolling');
//$('body').bind('touchmove', function(e){e.preventDefault()})


//Enter subject id
var subject_id = prompt("Enter subject id", "test");
var trial_order = prompt("Order (1-8)","1");
// var input = prompt("Enter input type (touch or click)","touch");

// jsPsych.data.addProperties({
// 	subject: subject_id,
// 	order: trial_order
// });

var publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1CbJfFGvxbQbdGwK85xz8LEIpOO0umJKJcSZ5L7aKB1E/pubhtml';

var tabletop = Tabletop.init( { key: publicSpreadsheetUrl,
                   callback: startExperiment,
                   // wanted:["Order_1"],
                   simpleSheet: false } )


// function showInfo(data, tabletop) {
//   alert('Successfully processed!')
//   console.log(data);
// }

// window.addEventListener('DOMContentLoaded', init)

document.body.style.backgroundColor = "black";
// document.body.style.backgroundImage = "url('stimuli/images/black-background.jpg')";
document.body.style.backgroundSize = "130%";
document.body.style.backgroundPosition = "top";
document.body.style.backgroundRepeat = "no-repeat";


var timeline = []

function createTrials(data, tabletop) {

  data = data['Order_'+trial_order]['elements']
  console.log(data);

  //stim = tabletop.sheets("stimulus_sheet").toArray()

  // var welcome = {
  //   type: "html-keyboard-response",
  //   stimulus: "Welcome to the experiment. Press any key to begin."
  // };

  var welcome = {
    type: "fullscreen",
    // fullscreen_mode: false,
    message: "",
    button_label: "Start",
    delay_after: 250
  }

  timeline.push(welcome);


  // var data = [
  //   {
  //     stimulus:"start",
  //     leftImage:"fireworks_left",
  //     rightImage:"fireworks_right"
  //   },
  //   {
  //     stimulus:"tever_teaching",
  //     leftImage:"Novel1",
  //     rightImage:"black"
  //   }
  // ];

  var expLength = data.length;
  var audioExt="stimuli/sounds/"
  var imageStart='<img src= "stimuli/images/'
  var imageStop= '.jpg"  title = "" width="300" height="250">'


  lwl_stimuli = []

  for (var i = 0; i < expLength; i++) {
    lwl_stimuli.push(
    {stimulus: audioExt+data[i]['stimulus']+".wav",
    choices:[imageStart+data[i]['left_image']+imageStop, imageStart+data[i]['right_image']+imageStop],
    set_background:data[i]['background'],
    data:{condition:data[i]['condition'],target_side:data[i]['target_side'],correct_response:data[i]['correct_response'],background:data[i]['background']}
    })
    // {stimulus: audioExt+data['elements'][i]['stimulus']+".wav",
    // choices:[imageStart+data['elements'][i]['left_image']+imageStop, imageStart+data['elements'][i]['right_image']+imageStop],
    // data:{condition:data['elements'][i]['condition'],target_side:data['elements'][i]['target_side'],correct_response:data['elements'][i]['correct_response']}
    // })

    // console.log(lwl_stimuli);
    // console.log(lwl_stimuli[i]['stimulus'])
    // console.log(lwl_stimuli[i]['choices'])
  }


  var lwl_trials = {
    type: 'audio-button-response-flexiblelocations',
    margin_top: ['500px','500px'],
    margin_bottom: ['0px','0px'],
    margin_left: ['0px','89px'],
    margin_right: ['89px','0px'],
    // set_background: 'face-closed',
    // set_background:data.background,
    timeline: lwl_stimuli,
    data: jsPsych.timelineVariable('data'),
    on_finish: function(data) {
      data.correct = data.button_pressed == data.correct_response;
    }
  }

  timeline.push(lwl_trials);

  var fullscreen_exit = {
    type: 'fullscreen',
    fullscreen_mode: false
  }
  timeline.push(fullscreen_exit)
};



// Papa.parse('http://sapir.psych.wisc.edu/~zettersten/experiments/demos/lwl_demo/trial_order/YumME_Beta.csv', {
//   // delimiter: ",",
//   header: true,
//   download: true,
//   dynamicTyping: true,
//   complete: function(results) {
//     console.log(results);
//     var data = results.data;
//     // data.push(results);
//     console.log(data);
// 	createTrials(data);
// 	startExperiment();
//   }
// });

function startExperiment(data, tabletop) {
	createTrials(data,tabletop);
jsPsych.init({
  timeline: timeline,
  on_finish: function() {
    jsPsych.data.displayData();
  }
});
};


</script>

</html>
